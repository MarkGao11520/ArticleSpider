<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="ie-stand">
    <title>ERP登录</title>
    <!-- S DNS预解析 -->
    <link rel="dns-prefetch" href="">
    <!-- E DNS预解析 -->
    <link rel="stylesheet" href="/res/css/sso_login.css">
    <link rel="stylesheet" href="/res/css/login.min.css">
</head>
<body>

<div class="login">
    <div class="valign_wrap">
        <!-- +.withqrc 切换 -->
        <div class="login_pop">
            <div class="login_pop_inner login_withpc">
                <!--[if lt IE 8]><span class="login_withpc_logo"></span><![endif]-->
                <form class="login_form"  method="post" name="login_form">
                    <input type="hidden" id="fp" name="fp">
                    <!-- +.warn +.focus +.hide -->
                    <div class="login_form_row account"><label class="login_form_label"><i class="login_form_icon"></i>
                        <div class="login_form_inp"><input class="login_form_inp_input" type="text" id="username" name="username" placeholder="用户名">
                        </div>
                    </label></div>
                    <div class="login_form_row password"><label class="login_form_label"><i class="login_form_icon"></i>
                        <div class="login_form_inp"><input class="login_form_inp_input" type="password" id="password" name="password" placeholder="密码">
                        </div>
                    </label></div>

                    <div class="login_form_row findback"><a href="/sso/findpwd/index">忘记密码？</a></div>
                    <div class="login_form_row formsubmit"><input class="formsubmit_btn" type="submit"
                                                                  value="登&nbsp;&nbsp;录"></div>
                    <div class="login_form_row warntip hide"><i class="warntip_icon"></i><span class="warntip_text"></span>
                    </div>
                </form>
                <a class="login_style" href="javascript:;"></a>
            </div>
            <!-- +.succ -->
            <div class="login_pop_inner login_withqrc">
                <div class="login_withqrc_wrap">
                    <div class="login_withqrc_tit">用京东ME 扫码安全登录</div>
                    <div class="login_withqrc_code"><img id="qr_image" src="" width="150" height="150">
                    </div>
                    <div class="login_withqrc_tip"><a id="refresh_code" href="javascript:;">刷新二维码</a> <span class="login_withqrc_tip_sep">|</span>
                        支持京东ME v2.6.0以上版本
                    </div>
                    <div class="login_form_row warntip hide"><i class="warntip_icon"></i><span class="warntip_text"></span>
                    </div>
                </div>
                <div class="login_withqrc_result">
                    <div class="login_withqrc_doge"></div>
                    <div class="login_withqrc_succ">扫描成功！</div>
                    <div class="login_withqrc_tip">请在手机上确认是否登录</div>
                </div>
                <a class="login_style" href="javascript:;"></a>
            </div>
        </div>
    </div>
    <!--[if lt IE 8]><span class="valign_after"></span><![endif]-->
</div>

<script src="/res/js/jquery.min.js"></script>
<script src="/res/js/nest.js"></script>
<script src="//payrisk.jd.com/js/td.js?v=1509446838875" type="text/javascript"></script>
<script>
    var dpr = window.devicePixelRatio || 1;
    var scale = 1 / dpr;
    var docEl = document.documentElement;
    docEl.setAttribute('data-dpr', dpr);

    //---------------------------------------
    var MAX_TIMES= 60;

    $(function () {
        var timeout = false;
        var returnUrl = "http://ssa.jd.com/";
        var qrCheck;

        function refreshImage() {
            var now = new Date();
            $("#qr_image").attr("src", "/sso/image?v=33&t=" + now.getTime());
            stopCheck();
            startCheck();
            $('.warntip').hide();
        }

        function stopCheck() {
            if (qrCheck != null) {
                timeout = true;
                window.clearInterval(qrCheck);
            }
        }

        function startCheck() {
            timeout = false;
            qrCheck = window.setInterval(check, 1000);
        }

        function show_notice(content){
            $('.warntip_text').html(content);
            $('.warntip').show();
        }

        function check() {
            if (timeout) {
                return;
            }
            $.post("/sso/check.json", {"ReturnUrl": returnUrl,"fp":$("#fp").val(), "_t": (new Date()).getTime()}, function (data) {
                if(data.REQ_CODE == -1){
                    show_notice("登录超时，请刷新后重新扫描");
                    $('.login_withqrc').removeClass('succ');
                    stopCheck();
                }else if(data.REQ_CODE == 202){
                    $('.login_withqrc').addClass('succ');
                    show_notice("等待手机客户端确认，请勿刷新页面");
                }else if(data.REQ_CODE == 205){
                    stopCheck();
                    window.location.href=data.REQ_DATA;
                }else if(data.REQ_CODE!== 201){
                    show_notice(data.REQ_MSG);
                    $('.login_withqrc').removeClass('succ');
                    stopCheck();
                }
            },"json");
        }

        //设备指纹开始
        try{
            getJdEid(function(eid,fp){
                $("#fp").val(eid);
            });
        }catch(e){
            //你的逻辑
        }
        //设备指纹结束

        $('.login_form_inp_input').focus(function () {
            $('.login_form_row.focus').removeClass('focus');
            $(this).parents('.login_form_row').addClass('focus');
        }).blur(function () {
            $('.login_form_row.focus').removeClass('focus');
        });
        $('.login_style').click(function () {
            $('.login_pop').toggleClass('withqrc');
            if($('.login_pop').hasClass("withqrc")){
                refreshImage();
            }else{
                stopCheck();
            }
        });

        $("#refresh_code").click(function () {
            refreshImage();
        });

        $('.formsubmit_btn').click(function (event) {
            if($("#username").val() ==""){
                $('.login_form_row.account').addClass('warn');
                event.preventDefault();
            }
            if($("#password").val() ==""){
                $('.login_form_row.password').addClass('warn');
                event.preventDefault();
            }
        });

        if($.trim($('.warntip_text').html())!=""){
            $('.warntip').show();
        }

        $("#jetui_erp_gx_close").click(function () {
            $("#erp_gx").hide();
        });

        function preloadimages(arr){
            var newimages=[];
            var arr = (typeof arr!="object") ? [arr] : arr;  //确保参数总是数组
            for (var i=0; i<arr.length; i++){
                newimages[i] = new Image();
                newimages[i].src = arr[i];
            }
        }
        var isX2img = dpr==1 ? '' : '@2x';
        preloadimages([
            '/res/images/active-account'+isX2img+'.png',
            '/res/images/active-pass'+isX2img+'.png',
            '/res/images/default-account'+isX2img+'.png',
            '/res/images/default-pass'+isX2img+'.png',
            '/res/images/fatdog'+isX2img+'.png',
            '/res/images/logo'+isX2img+'.png',
            '/res/images/warn'+isX2img+'.png',
            '/res/images/warn-account'+isX2img+'.png',
            '/res/images/warn-pass'+isX2img+'.png',
            '/res/images/withpc'+isX2img+'.png',
            '/res/images/withqrc'+isX2img+'.png'
        ]);

        
            });
</script>
</body>
</html>